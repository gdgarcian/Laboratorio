/*!CK:41795288!*//*1454535553,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["byxln"]); }

__d('PubcontentFeedChainingControllerX',['AggregatedLinkComposerConfig','Arbiter','AsyncRequest','AttachmentRelatedShareConstants','ContextualThing','CSS','DOM','DOMQuery','FeedAdsChainingConfig','NavigationMessage','PageLikeConstants','PubcontentFeedChainingConfig','PubcontentRelatedShareChainingConfig','PubcontentTopicChainingConfig','RelatedEventsPivotChainingConfig','Run','SearchRelatedPostsPivotChainingConfig','StoryInlinePivotChainingConfig','StoryTopicMap','SubscriptionsHandler','UFIFeedbackTargets','UFIUIEvents','XEventRelatedEventsPivotController','XFeedAdsChainingController','XPubcontentFeedChainingController','XPubcontentInlineStoryPivotChainingController','XPubcontentRelatedShareChainingController','XPubcontentRelatedVideoChainingController','XPubcontentTopicChainingController','XRelatedGamesChainingController','XSearchRelatedPostsPivotController','XQuickPromotionFeedPivotController','csx','cx','getOrCreateDOMID'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){if(c.__markCompiled)c.__markCompiled();var qa='ei',ra='ad_fan_page_action',sa='ad_like_page_post_action',ta='page_story_like_action',ua='related_share_article_click',va='related_share_video_click',wa='page_share_like_action',xa='topic_story_like_action',ya='story_click_for_pivot_action',za='story_like_pivot_action',ab='event_join',bb='composer_publish_action',cb=null,db=false;eb.init=function(fb){'use strict';var gb=fb.isLazy;if(!cb)cb=new eb({isLazy:gb});if(!db){w.onLeave(eb.cleanup);i.subscribe(q.NAVIGATION_BEGIN,eb.cleanup);db=true;}};eb.cleanup=function(){'use strict';if(cb){cb.cleanup();cb=null;}};function eb(fb){'use strict';var gb=fb.isLazy;this.$PubcontentFeedChainingControllerX1=s;this.$PubcontentFeedChainingControllerX2=p;this.$PubcontentFeedChainingControllerX3=t;this.$PubcontentFeedChainingControllerX4=u;this.$PubcontentFeedChainingControllerX5=y;this.$PubcontentFeedChainingControllerX6=v;this.$PubcontentFeedChainingControllerX7=x;this.$PubcontentFeedChainingControllerX8={};this.$PubcontentFeedChainingControllerX9=new aa();this.$PubcontentFeedChainingControllerX9.addSubscriptions(this.$PubcontentFeedChainingControllerX10(r.LIKED,gb,this.$PubcontentFeedChainingControllerX11.bind(this)),this.$PubcontentFeedChainingControllerX10(ca.ActionLinkLike,gb,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX10(ca.ReactionButtonClicked,gb,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX10(ca.Comment,gb,this.$PubcontentFeedChainingControllerX13.bind(this)),this.$PubcontentFeedChainingControllerX10('composer/publish',gb,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX10('LitestandComposer/publish',gb,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX10(k.ARTICLE_CLICK,gb,this.$PubcontentFeedChainingControllerX15.bind(this)),this.$PubcontentFeedChainingControllerX10(k.VIDEO_CLICK,gb,this.$PubcontentFeedChainingControllerX16.bind(this)),this.$PubcontentFeedChainingControllerX10(k.FBVIDEO_CLICK,gb,this.$PubcontentFeedChainingControllerX17.bind(this)),this.$PubcontentFeedChainingControllerX10(k.GAME_CLICK,gb,this.$PubcontentFeedChainingControllerX18.bind(this)),this.$PubcontentFeedChainingControllerX10(k.PHOTO_CLICK,gb,this.$PubcontentFeedChainingControllerX19.bind(this)),this.$PubcontentFeedChainingControllerX10(k.EVENT_JOIN,gb,this.$PubcontentFeedChainingControllerX20.bind(this)));}eb.prototype.$PubcontentFeedChainingControllerX10=function(event,fb,gb){'use strict';var hb=fb?[event,event+'.lazy']:[event];return i.subscribe(hb,gb);};eb.prototype.cleanup=function(){'use strict';this.$PubcontentFeedChainingControllerX9&&this.$PubcontentFeedChainingControllerX9.release();this.$PubcontentFeedChainingControllerX9=null;};eb.getAdClientTokenIndex=function(){'use strict';return qa;};eb.prototype.$PubcontentFeedChainingControllerX11=function(fb,gb){'use strict';var hb=this.findAdClientToken(gb.target);if(hb){this.$PubcontentFeedChainingControllerX21(gb.target,{origin:ra,actor_id:gb.profile_id,client_token:hb});}else this.$PubcontentFeedChainingControllerX22(gb.target,{origin:gb.origin,actor_id:gb.profile_id});};eb.prototype.$PubcontentFeedChainingControllerX12=function(fb,gb){'use strict';if(!gb.ft_id||!gb.target)return;if(!this.$PubcontentFeedChainingControllerX23(this.findStory(gb.target))||this.$PubcontentFeedChainingControllerX24(this.findStory(gb.target)))return;ba.getFeedbackTarget(gb.ft_id,(function(hb,ib){var jb=this.findAdClientToken(hb);if(jb&&ib.isshare){this.$PubcontentFeedChainingControllerX21(hb,{actor_id:ib.actorid,origin:sa,ft_id:ib.entidentifier,client_token:jb});}else if(ib.isownerpage){this.$PubcontentFeedChainingControllerX22(hb,{actor_id:ib.actorid,content_id:ib.entidentifier,origin:ta});}else if(ib.isshare){this.$PubcontentFeedChainingControllerX22(hb,{actor_id:ib.actorid,content_id:ib.entidentifier,ft_id:ib.entidentifier,origin:wa});}else{var kb=z.getTopicsForFTID(ib.entidentifier);if(kb&&kb.length>0){this.$PubcontentFeedChainingControllerX25(hb,{ft_id:ib.entidentifier,origin:xa,pivotal_topic_ids:kb});}else this.$PubcontentFeedChainingControllerX26(hb,{origin:za,ft_id:ib.entidentifier});}}).bind(this,gb.target));};eb.prototype.$PubcontentFeedChainingControllerX13=function(fb,gb){'use strict';if(!gb.ft_id||!gb.target)return;if(!this.$PubcontentFeedChainingControllerX23(this.findStory(gb.target))||this.$PubcontentFeedChainingControllerX24(this.findStory(gb.target)))return;this.$PubcontentFeedChainingControllerX27(gb.target,{origin:ua,action_trigger:'COMMENT',ft_id:gb.ft_id});};eb.prototype.$PubcontentFeedChainingControllerX26=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=ga.getURIBuilder().setString('origin',gb.origin);if(gb.story_id)ib.setString('storyid',String(gb.story_id));if(gb.ft_id)ib.setString('ftid',String(gb.ft_id));new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib.getURI()).setAllowCrossPageTransition(true).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX19=function(fb,gb){'use strict';var hb=this;hb.$PubcontentFeedChainingControllerX26(gb.attachment,{origin:ya,story_id:gb.storyid});};eb.prototype.$PubcontentFeedChainingControllerX15=function(fb,gb){'use strict';if(h.no_chained_related_stories==='true')return;gb.origin=ua;var hb=this,ib=this.findStory(gb.attachment),jb=o.scry(o.getRootElement(),'#initial_browse_result').length>0;if(jb)return;var kb;if(gb.is_right_click){kb=0;}else kb=k.EVENT_DELAY;setTimeout(function(){if(ib){var lb=hb.findAttachment(ib);if(lb)gb.attachment=lb;}hb.$PubcontentFeedChainingControllerX30(gb.attachment,gb);},kb);};eb.prototype.$PubcontentFeedChainingControllerX16=function(fb,gb){'use strict';gb.origin=va;var hb=this,ib=this.findStory(gb.attachment);setTimeout(function(){if(ib){var jb=hb.findAttachment(ib);if(jb)gb.attachment=jb;}hb.$PubcontentFeedChainingControllerX30(gb.attachment,gb);},k.EVENT_DELAY);};eb.prototype.$PubcontentFeedChainingControllerX17=function(fb,gb){'use strict';gb.origin=va;var hb=this,ib=this.findStory(gb.attachment);setTimeout(function(){if(ib){var jb=hb.findAttachment(ib);if(jb)gb.attachment=jb;}hb.$PubcontentFeedChainingControllerX30(gb.attachment,gb);},k.EVENT_DELAY);};eb.prototype.$PubcontentFeedChainingControllerX18=function(fb,gb){'use strict';var hb=this,ib=this.findStory(gb.attachment);setTimeout(function(){if(ib)var jb=hb.findContainer(ib);hb.$PubcontentFeedChainingControllerX31(ib,gb.global_share_id,pa(jb));},k.EVENT_DELAY);};eb.prototype.$PubcontentFeedChainingControllerX20=function(fb,gb){'use strict';var hb=this.findStory(gb.attachment);if(hb){var ib=this.findAttachment(hb);if(ib)gb.attachment=ib;}this.$PubcontentFeedChainingControllerX32(gb.attachment,{origin:ab,event_id:gb.event_id});};eb.prototype.$PubcontentFeedChainingControllerX14=function(fb,gb){'use strict';var hb=this;setTimeout(function(){hb.$PubcontentFeedChainingControllerX33(gb.markup.firstChild,{origin:bb,content_id:gb.content_id});},this.$PubcontentFeedChainingControllerX7.composer_publish_action);};eb.prototype.$PubcontentFeedChainingControllerX34=function(fb){'use strict';return !!(fb&&fb.id&&!m.hasClass(fb,"_sf6")&&!(fb.id in this.$PubcontentFeedChainingControllerX8));};eb.prototype.$PubcontentFeedChainingControllerX35=function(fb){'use strict';if(!fb)return false;if(fb.origin in this.$PubcontentFeedChainingControllerX1||fb.origin in this.$PubcontentFeedChainingControllerX3||fb.origin in this.$PubcontentFeedChainingControllerX2||fb.origin in this.$PubcontentFeedChainingControllerX5||fb.origin in this.$PubcontentFeedChainingControllerX6||fb.origin in this.$PubcontentFeedChainingControllerX7){return true;}else{var gb=this.$PubcontentFeedChainingControllerX4[fb.origin];if(!gb||!gb.rate)return false;var hb=Math.random();if(hb>gb.rate)return false;return true;}};eb.prototype.$PubcontentFeedChainingControllerX36=function(fb){'use strict';this.$PubcontentFeedChainingControllerX8[fb]=true;};eb.prototype.$PubcontentFeedChainingControllerX29=function(fb){'use strict';delete this.$PubcontentFeedChainingControllerX8[fb];};eb.prototype.$PubcontentFeedChainingControllerX23=function(fb){'use strict';if(!fb)return false;var gb="_3lkn",hb=fb.nextSibling,ib=true;if(hb&&hb.firstChild){var jb=hb.firstChild;ib=!(jb.hasChildNodes()&&m.hasClass(jb,gb));}if(!ib)return false;var kb=fb.children[0],lb=fb.children[1],mb="_4_ck";if(kb&&m.hasClass(kb,mb)||lb&&m.hasClass(lb,mb))return false;return true;};eb.prototype.$PubcontentFeedChainingControllerX24=function(fb){'use strict';if(!fb)return true;var gb=n.scry(fb,"._1xwr");if(gb.length)return true;return false;};eb.prototype.$PubcontentFeedChainingControllerX28=function(fb,gb){'use strict';var hb=this.findStory(fb);if(!this.$PubcontentFeedChainingControllerX34(hb))return null;if(!this.$PubcontentFeedChainingControllerX35(gb))return null;this.$PubcontentFeedChainingControllerX36(hb.id);if(this.isSponsoredStory(hb))return null;var ib;if(!gb.continued_chaining){ib=this.findContainer(hb);if(!ib)return null;var jb=n.create('div'),kb=n.appendContent(ib,jb);if(kb.length!==1)return null;}else{ib=hb;jb=n.create('div');kb=n.insertAfter(ib,jb);n.remove(ib);if(kb.length!==1)return null;}if(gb.is_auto_expand){return {chainingWrapper:kb[0],story:hb,is_auto_expand:gb.is_auto_expand};}else return {chainingWrapper:kb[0],story:hb};};eb.prototype.$PubcontentFeedChainingControllerX21=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=this.findStreamRoot(hb.story);if(!ib)return false;var jb=ib.getAttribute('id'),kb=ea.getURIBuilder().setString('actor_id',gb.actor_id).setString('origin',gb.origin).setString('ei',gb.client_token).setString('data_ownerid',jb);if(gb.ft_id)kb.setString('ft_id',gb.ft_id);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(kb.getURI()).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX30=function(fb,gb){'use strict';if(!this.$PubcontentFeedChainingControllerX23(this.findStory(fb)))return false;var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;m.addClass(hb.chainingWrapper,"_3lkn");var ib=null;if(gb.fbvideo_id){ib=ia.getURIBuilder();ib.setInt('fbvideo_id',gb.fbvideo_id);}else{ib=ha.getURIBuilder();ib.setInt('global_share_id',gb.global_share_id);}ib.setString('attachment_div_id',pa(gb.attachment));if(gb.link_url)ib.setString('link_url',gb.link_url);if(gb.video_div_id)ib.setString('video_div_id',gb.video_div_id);if(gb.share_id)ib.setString('share_id',gb.share_id);var jb=JSON.parse(hb.story.getAttribute('data-ft'))||{};if('qid' in jb&&'mf_story_key' in jb){ib.setString('qid',jb.qid);ib.setString('mf_story_key',jb.mf_story_key);}if(gb.is_auto_expand){this.$PubcontentFeedChainingControllerX29(hb.story.id);ib.setBool('is_auto_expand',gb.is_auto_expand);}var kb=new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib.getURI());jb&&kb.setData(jb);kb.send();return true;};eb.prototype.$PubcontentFeedChainingControllerX31=function(fb,gb,hb){'use strict';if(!this.$PubcontentFeedChainingControllerX34(fb))return null;this.$PubcontentFeedChainingControllerX36(fb.id);var ib=ka.getURIBuilder().setInt('app_id',gb).setString('attachment_div_id',hb);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,fb.id)).setURI(ib.getURI()).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX22=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=fa.getURIBuilder().setString('actor_id',gb.actor_id).setString('origin',gb.origin);if(gb.ft_id)ib.setString('ft_id',gb.ft_id);if(gb.content_id)ib.setString('content_id',gb.content_id);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib.getURI()).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX25=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=ja.getURIBuilder().setIntVector('pivotal_topic_ids',gb.pivotal_topic_ids).getURI();new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX32=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=da.getURIBuilder().setInt('event_id',gb.event_id).setString('attachment_id',pa(fb)).getURI();new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX33=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=la.getURIBuilder().setString('origin',gb.origin).setString('content_id',String(gb.content_id));new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib.getURI()).setAllowCrossPageTransition(true).send();return true;};eb.prototype.$PubcontentFeedChainingControllerX27=function(fb,gb){'use strict';var hb=this.$PubcontentFeedChainingControllerX28(fb,gb);if(!hb)return false;var ib=ma.getURIBuilder().setString('action_trigger',String(gb.action_trigger)).setInt('ft_id',gb.ft_id);new j().setErrorHandler(this.$PubcontentFeedChainingControllerX29.bind(this,hb.story.id)).setRelativeTo(hb.chainingWrapper).setURI(ib.getURI()).setAllowCrossPageTransition(true).send();return true;};eb.prototype.findStory=function(fb){'use strict';var gb="^div._4-u2",hb=n.scry(fb,gb);return hb.length===1?hb[0]:null;};eb.prototype.isSponsoredStory=function(fb){'use strict';var gb="._5paw";return n.scry(fb,gb).length>0;};eb.prototype.findAttachment=function(fb){'use strict';var gb="div._6m2",hb="div.iframeEmbed",ib=n.scry(fb,gb)[0]||n.scry(fb,hb)[0];return ib;};eb.prototype.findContainer=function(fb){'use strict';var gb=n.create('div'),hb=n.insertAfter(fb,gb);l.register(gb,fb);return hb.length>=1?hb[0]:null;};eb.prototype.findStreamRoot=function(fb){'use strict';var gb="^div._4ikz";return n.scry(fb,gb)[0];};eb.prototype.findAdClientToken=function(fb){'use strict';var gb=this.findStory(fb);if(!gb)return null;var hb=gb.getAttribute('data-ft');if(!hb)return null;var ib=JSON.parse(hb);return ib[eb.getAdClientTokenIndex()];};f.exports=eb;},null);